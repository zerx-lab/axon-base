# AxonDoc å‘é‡åŒ–ä¸çˆ¬è™«ä»»åŠ¡è°ƒç ”æŠ¥å‘Š

> è°ƒç ”æ—¥æœŸ: 2026-01-20
> ç›®æ ‡: æ·±å…¥åˆ†æå‘é‡åŒ–å’Œçˆ¬è™«ä»»åŠ¡çš„å®ç°ï¼Œè¯†åˆ«ä¼˜åŒ–ç©ºé—´ï¼Œæå‡äº¤äº’å‹å¥½æ€§å’Œå¯è§†åŒ–ç¾è§‚

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
+-------------------+     +------------------+     +-------------------+
|   Frontend        |     |   Next.js API    |     |   Backend         |
|   (React)         |<--->|   Routes         |<--->|   Services        |
+-------------------+     +------------------+     +-------------------+
        |                         |                        |
        v                         v                        v
+-------------------+     +------------------+     +-------------------+
| task-context.tsx  |     | /api/embeddings  |     | embeddings.ts     |
| TaskPanel.tsx     |     | /api/crawl       |     | crawler-service/  |
| CrawlDialog.tsx   |     | /api/webhook     |     | (Python FastAPI)  |
+-------------------+     +------------------+     +-------------------+
        |                         |                        |
        +-------------------------+------------------------+
                                  |
                                  v
                         +------------------+
                         |   Supabase       |
                         |   (PostgreSQL)   |
                         +------------------+
```

---

## äºŒã€å‘é‡åŒ–ä»»åŠ¡åˆ†æ

### 2.1 æ ¸å¿ƒæ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½ | ä»£ç è¡Œæ•° |
|---------|------|---------|
| `lib/embeddings.ts` | å‘é‡ç”Ÿæˆæ ¸å¿ƒé€»è¾‘ | 739 |
| `lib/task-context.tsx` | ä»»åŠ¡ç®¡ç†ä¸Šä¸‹æ–‡ | 646 |
| `lib/chunking/recursive-splitter.ts` | ä¸­æ–‡æ„ŸçŸ¥åˆ†å— | ~200 |
| `lib/chunking/context-generator.ts` | LLMä¸Šä¸‹æ–‡å¢å¼º | ~150 |
| `app/api/embeddings/route.ts` | API ç«¯ç‚¹ | 198 |
| `components/TaskPanel.tsx` | ä»»åŠ¡é¢æ¿ UI | 257 |

### 2.2 å¤„ç†æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» "Embed" æŒ‰é’®
        |
        v
+-------------------+
| 1. å‰ç«¯ä»»åŠ¡åˆ›å»º   |  addTask() -> localStorage æŒä¹…åŒ–
+-------------------+
        |
        v
+-------------------+
| 2. API è¯·æ±‚å‘é€   |  POST /api/embeddings
+-------------------+
        |
        v
+-------------------+
| 3. åç«¯å¼‚æ­¥å¤„ç†   |  Next.js after() + åˆ†å— + å‘é‡ç”Ÿæˆ
+-------------------+
        |
        v
+-------------------+
| 4. å‰ç«¯è½®è¯¢æ£€æµ‹   |  æ¯ 2 ç§’ GET /api/embeddings æŸ¥è¯¢çŠ¶æ€
+-------------------+
        |
        v
+-------------------+
| 5. å®Œæˆå›è°ƒ       |  æ›´æ–° UI + åˆ·æ–°æ–‡æ¡£åˆ—è¡¨
+-------------------+
```

### 2.3 çŠ¶æ€æµè½¬

```
æ–‡æ¡£å‘é‡åŒ–çŠ¶æ€ (embedding_status):
  pending â”€â”€> processing â”€â”€> completed
                        â””â”€â”€> failed
                        â””â”€â”€> outdated (å†…å®¹å˜æ›´è§¦å‘)

ä»»åŠ¡çŠ¶æ€ (task.status):
  pending â”€â”€> running â”€â”€> completed
                     â””â”€â”€> failed
                     â””â”€â”€> cancelled
```

### 2.4 å½“å‰é—®é¢˜ä¸ä¼˜åŒ–ç©ºé—´

#### P0 - å…³é”®é—®é¢˜

| é—®é¢˜ | å½±å“ | ä¼˜åŒ–å»ºè®® |
|------|------|---------|
| æ— è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º | ç”¨æˆ·æ— æ³•äº†è§£å®é™…è¿›åº¦ | æ˜¾ç¤º "50/100 chunks processed" |
| æ— é¢„ä¼°å®Œæˆæ—¶é—´ | ç”¨æˆ·ä¸çŸ¥é“éœ€è¦ç­‰å¾…å¤šä¹… | åŸºäº chunk æ•°é‡å’Œå†å²æ•°æ®è®¡ç®— ETA |
| ä¸²è¡Œå¤„ç†å¤šæ–‡æ¡£ | æ‰¹é‡åµŒå…¥æ•ˆç‡ä½ | å¹¶è¡Œå¤„ç†ï¼Œæ§åˆ¶å¹¶å‘æ•° |

#### P1 - ä½“éªŒé—®é¢˜

| é—®é¢˜ | å½±å“ | ä¼˜åŒ–å»ºè®® |
|------|------|---------|
| å¤±è´¥åéœ€æ‰‹åŠ¨é‡è¯• | æ“ä½œç¹ç | è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆ3æ¬¡ + æŒ‡æ•°é€€é¿ï¼‰|
| æ— ç¼“å­˜æœºåˆ¶ | é‡å¤å†…å®¹é‡å¤å¤„ç† | åŸºäº content_hash è·³è¿‡å·²å¤„ç† |
| ä»»åŠ¡é¢æ¿ä½ç½®å›ºå®š | å¯èƒ½é®æŒ¡å†…å®¹ | æ”¯æŒæ‹–æ‹½ã€æœ€å°åŒ–ã€è‡ªåŠ¨éšè— |
| æ— å¢é‡æ›´æ–° | ä¿®æ”¹å°éƒ¨åˆ†éœ€å…¨é‡é‡æ–°å¤„ç† | æ£€æµ‹å˜æ›´ï¼Œä»…æ›´æ–°å˜åŒ–çš„ chunk |

---

## ä¸‰ã€çˆ¬è™«ä»»åŠ¡åˆ†æ

### 3.1 æ ¸å¿ƒæ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½ |
|---------|------|
| `components/CrawlDialog.tsx` | çˆ¬è™«å‚æ•°é…ç½®å¯¹è¯æ¡† |
| `components/CrawlJobList.tsx` | çˆ¬è™«ä»»åŠ¡åˆ—è¡¨ç»„ä»¶ |
| `app/api/crawl/route.ts` | çˆ¬è™« API ä¸»å…¥å£ |
| `app/api/webhook/crawl/route.ts` | Webhook æ¥æ”¶å™¨ |
| `crawler-service/app/main.py` | FastAPI çˆ¬è™«æœåŠ¡å…¥å£ |
| `crawler-service/app/adaptive_crawler.py` | AI è‡ªé€‚åº”çˆ¬è™« |
| `crawler-service/app/job_manager.py` | ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç† |

### 3.2 å¤„ç†æµç¨‹

```
+---------------------------+
|  CrawlDialog è¡¨å•æäº¤     |
+---------------------------+
            |
            v
+---------------------------+
|  addTask() åˆ›å»ºä»»åŠ¡       |  -> localStorage
+---------------------------+
            |
            v
+---------------------------+
|  POST /api/crawl          |  -> Next.js API
+---------------------------+
            |
            v
+---------------------------+
|  Python Crawler Service   |  -> FastAPI åç«¯
+---------------------------+
            |
    +-------+-------+
    |               |
    v               v
+--------+    +----------+
| å• URL |    | å…¨ç«™çˆ¬è™« |
| (åŒæ­¥) |    | (å¼‚æ­¥)   |
+--------+    +----------+
    |               |
    v               v
+---------------------------+
|  Webhook å›è°ƒè¿›åº¦æ›´æ–°     |  -> /api/webhook/crawl
+---------------------------+
            |
            v
+---------------------------+
|  Supabase Realtime å¹¿æ’­   |  -> å‰ç«¯å®æ—¶æ›´æ–°
+---------------------------+
```

### 3.3 AI è‡ªé€‚åº”çˆ¬è™«ç‰¹æ€§

```
æ¡†æ¶é¢„è®¾æ”¯æŒ:
- Docusaurus, GitBook, VuePress
- MkDocs, Sphinx, ReadTheDocs
- Confluence, Notion
- Generic (é€šç”¨åå¤‡)

æå–æ¨¡å¼:
- auto:   LLM åˆ†æé¡µé¢ç»“æ„
- preset: ä½¿ç”¨æ¡†æ¶é¢„è®¾
- manual: ç”¨æˆ·è‡ªå®šä¹‰ CSS é€‰æ‹©å™¨

å­¦ä¹ æœºåˆ¶:
- æˆåŠŸæ—¶ confidence += 0.01
- å¤±è´¥æ—¶ confidence -= 0.05
- ç¼“å­˜åˆ° crawl_site_configs è¡¨
```

### 3.4 å½“å‰é—®é¢˜ä¸ä¼˜åŒ–ç©ºé—´

#### P0 - å…³é”®é—®é¢˜

| é—®é¢˜ | å½±å“ | ä¼˜åŒ–å»ºè®® |
|------|------|---------|
| å¹¶å‘é™åˆ¶ 4 | å¤§å‹ç½‘ç«™çˆ¬è™«æ…¢ | æµè§ˆå™¨æ± å¤ç”¨ï¼ŒåŠ¨æ€è°ƒæ•´ worker æ•° |
| æ— è‡ªåŠ¨é‡è¯• | ç½‘ç»œæ³¢åŠ¨å¯¼è‡´é¡µé¢ä¸¢å¤± | æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ3æ¬¡ï¼‰|
| è¿›åº¦æ›´æ–°å»¶è¿Ÿ | ç”¨æˆ·æ„ŸçŸ¥æ»å | Webhook æ‰¹é‡å‘é€ï¼ŒWebSocket æ›¿ä»£è½®è¯¢ |
| æ—  ETA æ˜¾ç¤º | ä¸çŸ¥é“ä½•æ—¶å®Œæˆ | åŸºäºçˆ¬å–é€Ÿç‡è®¡ç®—é¢„ä¼°æ—¶é—´ |

#### P1 - ä½“éªŒé—®é¢˜

| é—®é¢˜ | å½±å“ | ä¼˜åŒ–å»ºè®® |
|------|------|---------|
| é¡µé¢åˆ—è¡¨æ— è™šæ‹ŸåŒ– | å¤§é‡é¡µé¢æ—¶ UI å¡é¡¿ | ä½¿ç”¨ react-virtual è™šæ‹Ÿåˆ—è¡¨ |
| æš‚åœæ¢å¤ä¸ç¨³å®š | çŠ¶æ€å¯èƒ½ä¸åŒæ­¥ | å¢åŠ çŠ¶æ€ä¸€è‡´æ€§æ£€æŸ¥ |
| å®Œæˆåéœ€æ‰‹åŠ¨åˆ·æ–° | æ“ä½œç¹ç | è‡ªåŠ¨è§¦å‘ fetchDocuments() |
| é”™è¯¯ä¿¡æ¯ä¸æ¸…æ™° | éš¾ä»¥è¯Šæ–­é—®é¢˜ | ç»“æ„åŒ–é”™è¯¯åˆ†ç±»å’Œå±•ç¤º |

---

## å››ã€äº¤äº’å‹å¥½æ€§ä¼˜åŒ–å»ºè®®

### 4.1 ä»»åŠ¡é¢æ¿ä¼˜åŒ–

#### å½“å‰çŠ¶æ€
```
+---------------------------+
|  TASKS (2)          [-]   |
+---------------------------+
|  [â—] Embed: doc1          |
|      running              |
|  [â—‹] Crawl: example.com   |
|      pending              |
+---------------------------+
|  [Clear completed]        |
+---------------------------+
```

#### ä¼˜åŒ–åè®¾è®¡
```
+------------------------------------------+
|  TASKS                          [âˆ’] [Ã—]  |
+------------------------------------------+
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” |
|  â”‚ Embed: document-title.pdf           â”‚ |
|  â”‚ â”â”â”â”â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘ 65% | ETA: 2m 30s  â”‚ |
|  â”‚ 26/40 chunks | Speed: 5 chunks/s    â”‚ |
|  â”‚                         [Cancel]    â”‚ |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” |
|  â”‚ Crawl: example.com                  â”‚ |
|  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–‘â–‘â–‘ 85%            â”‚ |
|  â”‚ 85/100 pages | 2 failed | ETA: 30s  â”‚ |
|  â”‚                  [Pause] [Cancel]   â”‚ |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ |
+------------------------------------------+
|  [Clear All]      Completed: 5 | Failed: 1|
+------------------------------------------+
```

#### å…·ä½“æ”¹è¿›ç‚¹

| æ”¹è¿›é¡¹ | å®ç°æ–¹å¼ |
|-------|---------|
| è¿›åº¦æ¡ | ä½¿ç”¨ Tailwind æ¸å˜åŠ¨ç”»æ¡ |
| ETA æ˜¾ç¤º | `å‰©ä½™é¡¹ / å¤„ç†é€Ÿç‡` |
| å¤„ç†é€Ÿç‡ | æ»‘åŠ¨çª—å£å¹³å‡ï¼ˆæœ€è¿‘ 10 é¡¹ï¼‰|
| å¤±è´¥è®¡æ•° | çº¢è‰²å¾½ç« æ˜¾ç¤º |
| æ“ä½œæŒ‰é’® | Pause/Resume/Cancel |
| é¢æ¿æ‹–æ‹½ | react-draggable |
| è‡ªåŠ¨éšè— | æ— ä»»åŠ¡æ—¶ 3 ç§’åæ”¶èµ· |

### 4.2 æ–‡æ¡£åˆ—è¡¨çŠ¶æ€å±•ç¤ºä¼˜åŒ–

#### å½“å‰çŠ¶æ€
```
| Title    | Status     | Actions  |
|----------|------------|----------|
| doc1.pdf | Completed  | [Test]   |
| doc2.md  | Processing | [...]    |
| doc3.txt | Pending    | [Embed]  |
```

#### ä¼˜åŒ–åè®¾è®¡
```
| Title      | Vector Status              | Actions           |
|------------|----------------------------|-------------------|
| doc1.pdf   | [====] 100% | 25 chunks   | [Test] [Delete]   |
| doc2.md    | [===â–‘] 75%  | Processing  | [Cancel]          |
| doc3.txt   | [â–‘â–‘â–‘â–‘] 0%   | Pending     | [Start] [Skip]    |
| doc4.doc   | [!] Failed  | Retry in 5s | [Retry] [Skip]    |
```

#### å…·ä½“æ”¹è¿›ç‚¹

| æ”¹è¿›é¡¹ | æè¿° |
|-------|------|
| å†…è”è¿›åº¦æ¡ | è¡¨æ ¼å†…æ˜¾ç¤º mini è¿›åº¦æ¡ |
| Chunk è®¡æ•° | æ˜¾ç¤ºå®é™…/é¢„ä¼° chunk æ•° |
| è‡ªåŠ¨é‡è¯•å€’è®¡æ—¶ | å¤±è´¥åæ˜¾ç¤ºé‡è¯•å€’è®¡æ—¶ |
| æ‰¹é‡é€‰æ‹© | å¤é€‰æ¡†æ”¯æŒæ‰¹é‡æ“ä½œ |
| æ’åºç­›é€‰ | æŒ‰çŠ¶æ€/æ—¶é—´æ’åº |

### 4.3 çˆ¬è™«å¯¹è¯æ¡†ä¼˜åŒ–

#### å½“å‰çŠ¶æ€
```
+---------------------------+
|  Crawl Website            |
+---------------------------+
|  URL: [________________]  |
|  Mode: [Single URL â–¼]     |
|  Max Depth: [3]           |
|  Max Pages: [100]         |
|                           |
|  [Cancel]      [Start]    |
+---------------------------+
```

#### ä¼˜åŒ–åè®¾è®¡
```
+------------------------------------------+
|  Crawl Website                      [Ã—]  |
+------------------------------------------+
|  URL                                     |
|  [https://docs.example.com________] [?]  |
|  âœ“ Valid URL | Detected: Docusaurus      |
|                                          |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚ [â—] Single Page   [â—‹] Full Site   â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                          |
|  â”Œâ”€ Advanced Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   |
|  â”‚  Max Depth    [3]  â”â”â”â”â–‘â–‘â–‘â–‘ 1-10 â”‚   |
|  â”‚  Max Pages    [100] â”â”â–‘â–‘â–‘â–‘â–‘ 10-500â”‚   |
|  â”‚  [âœ“] Use AI Extraction            â”‚   |
|  â”‚  [âœ“] Follow Pagination            â”‚   |
|  â”‚  [ ] Include Images               â”‚   |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                          |
|  Preview: ~45 pages | ~15 min           |
|                                          |
|  [Cancel]                    [Start â†’]   |
+------------------------------------------+
```

#### å…·ä½“æ”¹è¿›ç‚¹

| æ”¹è¿›é¡¹ | æè¿° |
|-------|------|
| URL éªŒè¯å®æ—¶åé¦ˆ | è¾“å…¥æ—¶éªŒè¯ï¼Œæ˜¾ç¤ºæ£€æµ‹åˆ°çš„æ¡†æ¶ |
| æ»‘å—è°ƒèŠ‚ | ä½¿ç”¨ Slider æ›¿ä»£è¾“å…¥æ¡† |
| é¢„ä¼°æ˜¾ç¤º | æ˜¾ç¤ºé¢„ä¼°é¡µé¢æ•°å’Œæ—¶é—´ |
| åˆ†ç»„è®¾ç½® | æŠ˜å é«˜çº§è®¾ç½®ï¼Œç®€åŒ–ç•Œé¢ |
| æ¨¡å¼åˆ‡æ¢ | ä½¿ç”¨ SegmentedControl |

---

## äº”ã€å¯è§†åŒ–ç¾è§‚ä¼˜åŒ–å»ºè®®

### 5.1 è¿›åº¦åŠ¨ç”»

```css
/* è¿›åº¦æ¡æ¸å˜åŠ¨ç”» */
.progress-bar {
  background: linear-gradient(
    90deg,
    var(--primary) 0%,
    var(--primary-light) 50%,
    var(--primary) 100%
  );
  background-size: 200% 100%;
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { background-position: -100% 0; }
  100% { background-position: 100% 0; }
}

/* Processing çŠ¶æ€è„‰å†² */
.processing-pulse {
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
```

### 5.2 çŠ¶æ€å¾½ç« è®¾è®¡

```
Pending:    â—‹ ç°è‰²ç©ºå¿ƒåœ† + æµ…ç°èƒŒæ™¯
Processing: â— è“è‰²åŠåœ†åŠ¨ç”» + æµ…è“èƒŒæ™¯
Completed:  â— ç»¿è‰²å®å¿ƒ + æµ…ç»¿èƒŒæ™¯
Failed:     âœ• çº¢è‰²å‰å· + æµ…çº¢èƒŒæ™¯
Outdated:   âŸ³ é»„è‰²åˆ·æ–° + æµ…é»„èƒŒæ™¯
Paused:     â€– ç°è‰²æš‚åœ + æµ…ç°èƒŒæ™¯
```

### 5.3 ä»»åŠ¡å¡ç‰‡è®¾è®¡

```tsx
// ç¤ºä¾‹ï¼šä»»åŠ¡å¡ç‰‡ç»„ä»¶
<div className="group rounded-xl border border-border/50 bg-card/50 
               backdrop-blur-sm p-4 transition-all hover:border-border 
               hover:shadow-lg hover:shadow-primary/5">
  {/* çŠ¶æ€æŒ‡ç¤ºæ¡ */}
  <div className={cn(
    "absolute left-0 top-0 h-full w-1 rounded-l-xl",
    status === "running" && "bg-blue-500",
    status === "completed" && "bg-green-500",
    status === "failed" && "bg-red-500"
  )} />
  
  {/* ä»»åŠ¡ä¿¡æ¯ */}
  <div className="flex items-center justify-between">
    <div className="flex items-center gap-3">
      <StatusIcon status={status} />
      <div>
        <h4 className="font-medium">{title}</h4>
        <p className="text-sm text-muted-foreground">{subtitle}</p>
      </div>
    </div>
    <div className="opacity-0 transition-opacity group-hover:opacity-100">
      <ActionButtons />
    </div>
  </div>
  
  {/* è¿›åº¦åŒºåŸŸ */}
  {status === "running" && (
    <div className="mt-3">
      <ProgressBar value={progress} />
      <div className="mt-1 flex justify-between text-xs text-muted-foreground">
        <span>{processed}/{total} items</span>
        <span>ETA: {eta}</span>
      </div>
    </div>
  )}
</div>
```

### 5.4 æ•°æ®å¯è§†åŒ–

#### åµŒå…¥ç»Ÿè®¡ä»ªè¡¨ç›˜

```
+----------------------------------------------------------+
|  Embedding Overview                                       |
+----------------------------------------------------------+
|                                                          |
|   Documents        Chunks           Vectors              |
|   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           |
|   â”‚  125   â”‚      â”‚  2,450 â”‚       â”‚  2,450 â”‚           |
|   â”‚ total  â”‚      â”‚ total  â”‚       â”‚ 1536-d â”‚           |
|   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           |
|                                                          |
|   Status Distribution                                    |
|   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            |
|   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                         |
|   Completed: 95 | Pending: 20 | Failed: 5 | Outdated: 5  |
|                                                          |
+----------------------------------------------------------+
```

#### çˆ¬è™«ç»Ÿè®¡ä»ªè¡¨ç›˜

```
+----------------------------------------------------------+
|  Crawl Jobs Overview                          [Refresh]   |
+----------------------------------------------------------+
|                                                          |
|   Active Jobs    Pages Today    Success Rate             |
|   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               |
|   â”‚   3    â”‚    â”‚  1,234 â”‚     â”‚ 94.5%  â”‚               |
|   â”‚running â”‚    â”‚ crawledâ”‚     â”‚        â”‚               |
|   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜               |
|                                                          |
|   Recent Jobs Timeline                                   |
|   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   |
|   â”‚ â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—‹â”€â”€â”€â—‹                                â”‚   |
|   â”‚ 10:00  11:00  12:00  13:00  14:00               â”‚   |
|   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   |
|                                                          |
+----------------------------------------------------------+
```

---

## å…­ã€æŠ€æœ¯å®ç°å»ºè®®

### 6.1 è¿›åº¦è¿½è¸ªæ”¹è¿›

```typescript
// lib/task-context.tsx ä¸­æ·»åŠ è¿›åº¦è¿½è¸ª

interface TaskProgress {
  current: number;
  total: number;
  speed: number;      // items per second
  eta: number;        // seconds remaining
  startTime: number;
  lastUpdateTime: number;
}

function calculateETA(progress: TaskProgress): string {
  if (progress.speed === 0) return "Calculating...";
  const remaining = progress.total - progress.current;
  const seconds = Math.ceil(remaining / progress.speed);
  
  if (seconds < 60) return `${seconds}s`;
  if (seconds < 3600) return `${Math.ceil(seconds / 60)}m`;
  return `${Math.ceil(seconds / 3600)}h`;
}

function calculateSpeed(progress: TaskProgress): number {
  const elapsed = (progress.lastUpdateTime - progress.startTime) / 1000;
  return elapsed > 0 ? progress.current / elapsed : 0;
}
```

### 6.2 æŒ‡æ•°é€€é¿è½®è¯¢

```typescript
// æ›¿æ¢å›ºå®šé—´éš”è½®è¯¢

async function pollWithBackoff(
  checkFn: () => Promise<boolean>,
  options: {
    initialInterval: number;
    maxInterval: number;
    backoffFactor: number;
  }
): Promise<void> {
  let interval = options.initialInterval;
  
  while (true) {
    const isDone = await checkFn();
    if (isDone) break;
    
    await new Promise(r => setTimeout(r, interval));
    interval = Math.min(interval * options.backoffFactor, options.maxInterval);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
await pollWithBackoff(
  () => checkDocumentEmbeddingStatus(docId),
  { initialInterval: 1000, maxInterval: 15000, backoffFactor: 1.5 }
);
```

### 6.3 WebSocket å®æ—¶æ›´æ–°

```typescript
// æ›¿ä»£è½®è¯¢çš„ WebSocket æ–¹æ¡ˆ

// å‰ç«¯è®¢é˜…
useEffect(() => {
  const channel = supabase
    .channel(`task:${taskId}`)
    .on('broadcast', { event: 'progress' }, (payload) => {
      updateTaskProgress(payload.data);
    })
    .on('broadcast', { event: 'completed' }, (payload) => {
      markTaskComplete(payload.data);
    })
    .subscribe();
    
  return () => { channel.unsubscribe(); };
}, [taskId]);

// åç«¯å¹¿æ’­
async function broadcastProgress(taskId: string, progress: TaskProgress) {
  await supabase
    .channel(`task:${taskId}`)
    .send({
      type: 'broadcast',
      event: 'progress',
      payload: progress
    });
}
```

### 6.4 æ‰¹é‡æ“ä½œæ”¯æŒ

```typescript
// æ‰¹é‡åµŒå…¥ä¼˜åŒ–

interface BatchEmbedOptions {
  documentIds: string[];
  concurrency: number;  // å¹¶å‘æ•°
  onProgress: (completed: number, total: number) => void;
}

async function batchEmbedDocuments(options: BatchEmbedOptions) {
  const { documentIds, concurrency, onProgress } = options;
  const queue = [...documentIds];
  let completed = 0;
  
  const workers = Array(concurrency).fill(null).map(async () => {
    while (queue.length > 0) {
      const docId = queue.shift();
      if (!docId) break;
      
      await embedDocument(docId);
      completed++;
      onProgress(completed, documentIds.length);
    }
  });
  
  await Promise.all(workers);
}
```

---

## ä¸ƒã€ä¼˜å…ˆçº§æ’åº

### P0 - ç«‹å³å®æ–½ï¼ˆ1-2 å‘¨ï¼‰

| ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š | å·¥ä½œé‡ |
|-------|---------|-------|
| è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º | ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡ | 2 å¤© |
| ETA é¢„ä¼°æ—¶é—´ | å‡å°‘ç”¨æˆ·ç„¦è™‘ | 1 å¤© |
| æŒ‡æ•°é€€é¿è½®è¯¢ | å‡å°‘ 50% API è°ƒç”¨ | 1 å¤© |
| è¿›åº¦æ¡åŠ¨ç”»ç¾åŒ– | è§†è§‰ä½“éªŒæå‡ | 1 å¤© |
| çŠ¶æ€å¾½ç« é‡è®¾è®¡ | ä¿¡æ¯å±‚æ¬¡æ›´æ¸…æ™° | 1 å¤© |

### P1 - çŸ­æœŸå®æ–½ï¼ˆ2-4 å‘¨ï¼‰

| ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š | å·¥ä½œé‡ |
|-------|---------|-------|
| è‡ªåŠ¨é‡è¯•æœºåˆ¶ | æé«˜æˆåŠŸç‡ 10% | 3 å¤© |
| WebSocket å®æ—¶æ›´æ–° | å‡å°‘å»¶è¿Ÿæ„Ÿ | 5 å¤© |
| æ‰¹é‡é€‰æ‹©æ“ä½œ | æ“ä½œæ•ˆç‡æå‡ | 3 å¤© |
| ä»»åŠ¡é¢æ¿æ‹–æ‹½ | äº¤äº’çµæ´»æ€§ | 2 å¤© |
| è™šæ‹Ÿåˆ—è¡¨ | å¤§æ•°æ®æ€§èƒ½ | 2 å¤© |

### P2 - ä¸­æœŸå®æ–½ï¼ˆ1-2 æœˆï¼‰

| ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š | å·¥ä½œé‡ |
|-------|---------|-------|
| ç»Ÿè®¡ä»ªè¡¨ç›˜ | æ•°æ®æ´å¯Ÿ | 5 å¤© |
| å¢é‡æ›´æ–° | èŠ‚çœ 70% å¤„ç†æ—¶é—´ | 7 å¤© |
| å¹¶è¡Œå¤„ç†å¤šæ–‡æ¡£ | æ‰¹é‡æ•ˆç‡æå‡ 3x | 5 å¤© |
| ç»“æ„åŒ–æ—¥å¿—ç›‘æ§ | é—®é¢˜è¯Šæ–­æ•ˆç‡ | 5 å¤© |

---

## å…«ã€æ€»ç»“

### å½“å‰ç³»ç»Ÿä¼˜åŠ¿

- å®Œæ•´çš„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å¤šæä¾›å•†æ”¯æŒï¼ˆOpenAI/Azure/Aliyun/Localï¼‰
- AI è‡ªé€‚åº”çˆ¬è™«èƒ½åŠ›
- ä¸­æ–‡åˆ†å—ä¼˜åŒ–
- æ··åˆæœç´¢ + é‡æ’åº

### ä¸»è¦ä¼˜åŒ–æ–¹å‘

1. **è¿›åº¦å¯è§†åŒ–** - ä» "é»‘ç›’" å˜ä¸º "é€æ˜"
2. **æ™ºèƒ½è½®è¯¢** - ä» "å›ºå®šé—´éš”" å˜ä¸º "è‡ªé€‚åº”"
3. **é”™è¯¯æ¢å¤** - ä» "æ‰‹åŠ¨é‡è¯•" å˜ä¸º "è‡ªåŠ¨æ¢å¤"
4. **æ‰¹é‡æ•ˆç‡** - ä» "ä¸²è¡Œ" å˜ä¸º "å¹¶è¡Œ"
5. **è§†è§‰ç¾è§‚** - ä» "åŠŸèƒ½å‹" å˜ä¸º "ç²¾è‡´å‹"

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. å…ˆå®æ–½ P0 é¡¹ç›®ï¼Œå¿«é€Ÿæå‡ç”¨æˆ·ä½“éªŒ
2. æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œè°ƒæ•´ P1 ä¼˜å…ˆçº§
3. æ ¹æ®ä½¿ç”¨æ•°æ®ï¼Œå†³å®š P2 å®æ–½é¡ºåº

---

## ä¹ã€å®æ–½è¿›åº¦è¿½è¸ª

> æœ€åæ›´æ–°: 2026-01-20

### å·²å®Œæˆ âœ…

| ä¼˜åŒ–é¡¹ | å®ç°ä½ç½® | å®Œæˆæ—¥æœŸ |
|-------|---------|---------|
| è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º | `lib/task-context.tsx`, `components/TaskPanel.tsx` | 2026-01-20 |
| ETA é¢„ä¼°æ—¶é—´ | `lib/task-context.tsx:formatETA()`, `components/TaskPanel.tsx`, `components/CrawlJobList.tsx` | 2026-01-20 |
| æŒ‡æ•°é€€é¿è½®è¯¢ | `lib/task-context.tsx:pollWithExponentialBackoff()` | 2026-01-20 |
| è¿›åº¦æ¡åŠ¨ç”»ç¾åŒ– | `app/globals.css` (shimmer + pulse animations) | 2026-01-20 |
| çŠ¶æ€å¾½ç« é‡è®¾è®¡ | `components/TaskPanel.tsx` (with icons and colors) | 2026-01-20 |
| è‡ªåŠ¨é‡è¯•æœºåˆ¶ | `lib/task-context.tsx:retryWithBackoff()`, 3æ¬¡è‡ªåŠ¨é‡è¯• | 2026-01-20 |
| ä»»åŠ¡é¢æ¿å¯æœ€å°åŒ– | `components/TaskPanel.tsx` | 2026-01-20 |
| ä»»åŠ¡ç»Ÿè®¡æ  | `components/TaskPanel.tsx` (pending/running/completed/failed counts) | 2026-01-20 |
| æ‰‹åŠ¨é‡è¯•æŒ‰é’® | `lib/task-context.tsx:retryTask()`, `components/TaskPanel.tsx` | 2026-01-20 |
| çˆ¬è™« ETA æ˜¾ç¤º | `components/CrawlJobList.tsx:calculateCrawlETA()` | 2026-01-20 |
| i18n ç¿»è¯‘æ”¯æŒ | `lib/i18n.tsx` (task.minimize, task.retry, task.eta, task.speed, etc.) | 2026-01-20 |
| Build é”™è¯¯ä¿®å¤ | `app/api/search/route.ts` (document_source_url field) | 2026-01-20 |

### è¿›è¡Œä¸­ ğŸ”„

| ä¼˜åŒ–é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|-------|------|------|
| WebSocket å®æ—¶æ›´æ–° | å¾…å¼€å§‹ | ä½¿ç”¨ Supabase Realtime æ›¿ä»£è½®è¯¢ |
| æ‰¹é‡é€‰æ‹©æ“ä½œ | å¾…å¼€å§‹ | æ–‡æ¡£åˆ—è¡¨æ‰¹é‡åµŒå…¥ |

### å¾…å®æ–½ ğŸ“‹

| ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | é¢„ä¼°å·¥ä½œé‡ |
|-------|-------|-----------|
| æ‹–æ‹½ä»»åŠ¡é¢æ¿ | P1 | 2 å¤© |
| è™šæ‹Ÿåˆ—è¡¨ | P1 | 2 å¤© |
| ç»Ÿè®¡ä»ªè¡¨ç›˜ | P2 | 5 å¤© |
| å¢é‡æ›´æ–° | P2 | 7 å¤© |
| å¹¶è¡Œå¤„ç†å¤šæ–‡æ¡£ | P2 | 5 å¤© |

### å…³é”®æ–‡ä»¶å˜æ›´æ¸…å•

```
å·²ä¿®æ”¹:
- lib/task-context.tsx          # å®Œå…¨é‡å†™ï¼Œ646è¡Œ
- components/TaskPanel.tsx      # å®Œå…¨é‡å†™ï¼Œ450+è¡Œ
- components/CrawlJobList.tsx   # ETAåŠŸèƒ½å¢å¼º
- app/globals.css              # æ·»åŠ åŠ¨ç”»
- lib/i18n.tsx                 # 7ä¸ªæ–°ç¿»è¯‘é”®
- lib/supabase/types.ts        # RPCå‡½æ•°ç±»å‹
- app/api/search/route.ts      # ä¿®å¤ç±»å‹é”™è¯¯

æ„å»ºçŠ¶æ€: âœ… æˆåŠŸ
LintçŠ¶æ€: âœ… 0 errors, 17 warnings (é¢„å­˜åœ¨)
```
